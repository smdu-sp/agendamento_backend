generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id              String    @id @default(uuid())
  nome            String
  login           String    @unique
  email           String    @unique
  senha           String?   @db.VarChar(255)
  permissao       Permissao @default(PORTARIA)
  status          Boolean   @default(true)
  avatar          String?   @db.Text
  ultimoLogin     DateTime  @default(now())
  criadoEm        DateTime  @default(now())
  atualizadoEm    DateTime  @default(now()) @updatedAt
  nomeSocial      String?
  coordenadoriaId String?

  agendamentos  Agendamento[]
  coordenadoria Coordenadoria? @relation(fields: [coordenadoriaId], references: [id], onDelete: SetNull)

  @@map("usuarios")
}

model Agendamento {
  id                     String            @id @default(uuid())
  municipe               String?
  cpf                    String?
  processo               String?
  dataHora               DateTime
  dataFim                DateTime?
  importado              Boolean           @default(false)
  resumo                 String?           @db.Text
  tipoAgendamentoId      String?
  motivoNaoAtendimentoId String?
  coordenadoriaId        String?
  tecnicoId              String?
  tecnicoRF              String?
  email                  String?
  status                 StatusAgendamento @default(SOLICITADO)

  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @default(now()) @updatedAt

  tipoAgendamento      TipoAgendamento? @relation(fields: [tipoAgendamentoId], references: [id], onDelete: NoAction)
  motivoNaoAtendimento Motivo?          @relation(fields: [motivoNaoAtendimentoId], references: [id], onDelete: NoAction)
  coordenadoria        Coordenadoria?   @relation(fields: [coordenadoriaId], references: [id], onDelete: NoAction)
  tecnico              Usuario?         @relation(fields: [tecnicoId], references: [id], onDelete: NoAction)

  @@map("agendamentos")
}

model TipoAgendamento {
  id           String   @id @default(uuid())
  texto        String   @unique
  status       Boolean  @default(true)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @default(now()) @updatedAt

  agendamentos Agendamento[]

  @@map("tipos_agendamento")
}

model Motivo {
  id           String   @id @default(uuid())
  texto        String   @unique
  status       Boolean  @default(true)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @default(now()) @updatedAt

  agendamentos Agendamento[]

  @@map("motivos")
}

model Coordenadoria {
  id           String   @id @default(uuid())
  sigla        String   @unique
  nome         String?
  status       Boolean  @default(true)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @default(now()) @updatedAt

  agendamentos Agendamento[]
  usuarios     Usuario[]

  @@map("coordenadorias")
}

enum Permissao {
  DEV
  ADM
  TEC
  USR
  PONTO_FOCAL
  COORDENADOR
  PORTARIA
}

enum StatusAgendamento {
  SOLICITADO
  AGENDADO
  CANCELADO
  CONCLUIDO
  ATENDIDO
  NAO_REALIZADO
}
